# 程序测试日志与调试日志

------

## 目录

- [测试环境](https://chatgpt.com/c/6747e557-ba48-8008-8276-46294619eba6#测试环境)
- [测试目标](https://chatgpt.com/c/6747e557-ba48-8008-8276-46294619eba6#测试目标)
- 测试流程
  - [1. 系统初始化测试](https://chatgpt.com/c/6747e557-ba48-8008-8276-46294619eba6#1-系统初始化测试)
  - [2. 查看患者信息测试](https://chatgpt.com/c/6747e557-ba48-8008-8276-46294619eba6#2-查看患者信息测试)
  - [3. 添加新患者测试](https://chatgpt.com/c/6747e557-ba48-8008-8276-46294619eba6#3-添加新患者测试)
  - [4. 更新患者信息测试](https://chatgpt.com/c/6747e557-ba48-8008-8276-46294619eba6#4-更新患者信息测试)
  - [5. 删除患者测试](https://chatgpt.com/c/6747e557-ba48-8008-8276-46294619eba6#5-删除患者测试)
  - [6. 生成健康报告测试](https://chatgpt.com/c/6747e557-ba48-8008-8276-46294619eba6#6-生成健康报告测试)
  - [7. 导入数据测试](https://chatgpt.com/c/6747e557-ba48-8008-8276-46294619eba6#7-导入数据测试)
  - [8. 导出数据测试](https://chatgpt.com/c/6747e557-ba48-8008-8276-46294619eba6#8-导出数据测试)
- 调试日志
  - [问题1：模块导入失败 (`ImportError`)](https://chatgpt.com/c/6747e557-ba48-8008-8276-46294619eba6#问题1模块导入失败-importerror)
  - [问题2：程序无输出，无响应](https://chatgpt.com/c/6747e557-ba48-8008-8276-46294619eba6#问题2程序无输出无响应)
  - [问题3：数据未正确加载](https://chatgpt.com/c/6747e557-ba48-8008-8276-46294619eba6#问题3数据未正确加载)
  - [问题4：数据导出时权限错误 (`PermissionError`)](https://chatgpt.com/c/6747e557-ba48-8008-8276-46294619eba6#问题4数据导出时权限错误-permissionerror)
- [总结](https://chatgpt.com/c/6747e557-ba48-8008-8276-46294619eba6#总结)

------

## 测试环境

- **操作系统**：Windows 10 专业版 64位
- **Python 版本**：Python 3.8.5
- **编辑器**：Visual Studio Code
- **终端**：Windows PowerShell

------

## 测试目标

- **功能验证**：确保患者健康记录管理系统的各项功能按预期运行。
- **稳定性测试**：检查程序在异常输入和操作下的稳定性和健壮性。
- **数据完整性**：验证数据的正确读写和存储，确保数据的一致性。
- **用户体验**：评估交互界面的友好程度和提示信息的准确性。

------

## 测试流程

### **1. 系统初始化测试**

**步骤：**

- 打开终端，进入项目根目录 `health_system`。
- 运行命令：`python main.py`。

**预期结果：**

- 程序正常启动，显示系统主菜单。

**实际结果：**

- 程序启动成功，显示：

  ```
  启动健康记录管理系统...
  === 患者健康记录管理系统 ===
  1. 查看患者信息
  2. 添加新患者
  3. 更新患者信息
  4. 删除患者
  5. 生成健康报告
  6. 导入数据
  7. 导出数据
  8. 退出系统
  请选择操作(1-8):
  ```

**结论：**

- 系统初始化正常，程序启动无误。

------

### **2. 查看患者信息测试**

**步骤：**

- 选择操作 `1`，查看患者信息。
- 输入存在的患者ID，例如 `P001`。
- 输入不存在的患者ID，例如 `P999`。

**预期结果：**

- 存在的患者信息应正确显示。
- 不存在的患者ID，应提示“未找到该患者。”

**实际结果：**

- 输入 `P001`，显示患者详细信息。
- 输入 `P999`，提示“未找到该患者。”

**结论：**

- 查看患者信息功能正常。

------

### **3. 添加新患者测试**

**步骤：**

- 选择操作 `2`，添加新患者。

- 输入有效的患者信息：

  ```
  请输入患者ID(以'P'开头): P101
  请输入姓名: 李四
  请输入年龄(0-120): 30
  请输入性别(男/女): 男
  请输入身高(cm): 175
  请输入体重(kg): 70
  请输入血压(收缩压/舒张压): 120/80
  请输入血糖值(mmol/L): 5.5
  请输入胆固醇值(mmol/L): 4.0
  请输入检查日期(YYYY-MM-DD): 2024-05-01
  ```

- 再次添加患者，使用已存在的患者ID `P001`。

**预期结果：**

- 新患者添加成功，提示“患者添加成功。”
- 使用已存在的患者ID，提示“患者ID已存在。”

**实际结果：**

- 新患者 `P101` 添加成功。
- 添加已存在的患者ID `P001`，提示“患者ID已存在。”

**结论：**

- 添加新患者功能正常，数据验证有效。

------

### **4. 更新患者信息测试**

**步骤：**

- 选择操作 `3`，更新患者信息。

- 输入存在的患者ID `P101`。

- 更新部分信息：

  ```
  请输入要更新的患者ID: P101
  请输入新的患者信息:
  请输入姓名: 李四更新
  请输入年龄(0-120): 31
  请输入性别(男/女): 男
  请输入身高(cm): 176
  请输入体重(kg): 72
  请输入血压(收缩压/舒张压): 118/78
  请输入血糖值(mmol/L): 5.6
  请输入胆固醇值(mmol/L): 4.1
  请输入检查日期(YYYY-MM-DD): 2024-06-01
  ```

- 输入不存在的患者ID `P999`。

**预期结果：**

- 更新成功，提示“患者信息更新成功。”
- 不存在的患者ID，提示“未找到该患者。”

**实际结果：**

- 更新 `P101` 成功。
- 更新 `P999`，提示“未找到该患者。”

**结论：**

- 更新患者信息功能正常。

------

### **5. 删除患者测试**

**步骤：**

- 选择操作 `4`，删除患者。
- 输入存在的患者ID `P101`。
- 再次尝试删除同一ID `P101`。

**预期结果：**

- 第一次删除成功，提示“患者删除成功。”
- 第二次删除，提示“患者不存在。”

**实际结果：**

- 删除 `P101` 成功。
- 再次删除 `P101`，提示“患者不存在。”

**结论：**

- 删除患者功能正常，异常处理有效。

------

### **6. 生成健康报告测试**

**步骤：**

- 选择操作 `5`，生成健康报告。

- 输入存在的患者ID `P001`。

- 选择不输入额外健康数据。

- 再次生成报告，选择输入额外健康数据：

  ```
  是否输入额外的健康数据（心率、体温）？(y/n): y
  请输入心率(bpm): 75
  请输入体温(℃): 36.8
  ```

- 输入不存在的患者ID `P999`。

**预期结果：**

- 生成报告成功，显示报告内容。
- 报告文件保存于 `reports/` 目录。
- 不存在的患者ID，提示“未找到该患者。”

**实际结果：**

- 生成 `P001` 的健康报告成功，报告内容正确，文件生成。
- 输入 `P999`，提示“未找到该患者。”

**结论：**

- 生成健康报告功能正常。

------

### **7. 导入数据测试**

**步骤：**

- 准备 CSV 文件 `import_data.csv`，内容：

  ```
  P102,王五,40,男,180,80,130/85,6.0,5.0,2024-05-15
  P103,赵六,35,女,165,60,120/75,5.5,4.5,2024-05-20
  ```

- 选择操作 `6`，导入数据。

- 输入文件路径和类型：

  ```
  请输入要导入的文件路径: C:\Users\willi\Desktop\health_system\import_data.csv
  请输入文件类型(csv/json): csv
  ```

**预期结果：**

- 数据导入成功，提示“数据导入成功。”
- 新患者信息可正常查看。

**实际结果：**

- 导入数据成功。
- 查看 `P102` 和 `P103`，信息正确。

**结论：**

- 导入数据功能正常。

------

### **8. 导出数据测试**

**步骤：**

- 选择操作 `7`，导出数据。

- 输入错误的文件路径（缺少文件名）：

  ```
  请输入要导出的文件路径: C:\Users\willi\Desktop\health_system\export
  请输入文件类型(csv/json): csv
  ```

- 程序提示错误，要求输入包含文件名的完整路径。

- 输入正确的文件路径：

  ```
  请输入要导出的文件路径: C:\Users\willi\Desktop\health_system\exported_data.csv
  请输入文件类型(csv/json): csv
  ```

**预期结果：**

- 导出成功，提示“数据导出成功。”
- 文件 `exported_data.csv` 生成，内容正确。

**实际结果：**

- 首次导出失败，提示：

  ```
  数据导出失败: 导出数据时发生错误: 指定的路径是一个目录，请输入包含文件名的完整路径。
  ```

- 再次输入正确路径，导出成功。

**结论：**

- 导出数据功能正常，错误处理有效。

------

## 调试日志

### **问题1：模块导入失败 (`ImportError`)**

**现象：**

- 运行程序时，出现 `ImportError`，提示无法导入模块。

**分析：**

- 缺少 `__init__.py` 文件，导致 Python 无法识别包。
- 模块导入路径不正确。

**解决：**

- 在 `models` 和 `utils` 目录下添加空的 `__init__.py` 文件。

- 在 `main.py` 中添加以下代码，调整模块导入路径：

  ```python
  import sys
  import os
  sys.path.append(os.path.dirname(os.path.abspath(__file__)))
  ```

**结果：**

- 问题解决，模块导入成功，程序正常运行。

------

### **问题2：程序无输出，无响应**

**现象：**

- 运行 `python main.py` 后，无任何输出，也无报错。

**分析：**

- `main.py` 中缺少程序入口，没有调用主函数。

**解决：**

- 在 `main.py` 末尾添加：

  ```python
  if __name__ == "__main__":
      print("启动健康记录管理系统...")
      system = HealthSystem()
      system.run()
  ```

**结果：**

- 问题解决，程序启动并显示主菜单。

------

### **问题3：数据未正确加载**

**现象：**

- 数据文件中的患者信息未被正确读取，查看患者信息时提示“未找到该患者。”

**分析：**

- 数据文件格式与程序预期不符：
  - 分隔符为空格，程序预期为制表符。
  - 性别字段为 `M`、`F`，程序预期为 `男`、`女`。

**解决：**

- 修改 `DataManager` 的 `load_data` 方法：
  - 使用正则表达式拆分数据行，支持空格和制表符。
  - 在性别字段处理中，支持 `M`、`F`，并转换为 `男`、`女`。
- 修改 `Patient` 类的 `validate` 方法，增强数据验证。

**结果：**

- 问题解决，数据正确加载，患者信息显示正常。

------

### **问题4：数据导出时权限错误 (`PermissionError`)**

**现象：**

- 导出数据时，出现 `PermissionError: [Errno 13] Permission denied`。

**分析：**

- 导出路径为目录，未包含文件名。
- 程序尝试将数据写入一个目录，导致权限错误。

**解决：**

- 修改 `export_data` 方法，增加路径检查：

  ```python
  if os.path.isdir(file_path):
      raise ValueError("指定的路径是一个目录，请输入包含文件名的完整路径。")
  ```

- 在主程序中，提示用户输入正确的文件路径。

**结果：**

- 问题解决，导出数据成功。

------

## 总结

通过本次测试和调试，我们对患者健康记录管理系统的功能和稳定性进行了全面验证，确保了系统的可靠性和用户体验。

**主要收获：**

- **严谨的测试流程**：逐项功能测试，发现并解决了潜在问题。
- **有效的异常处理**：通过捕获和处理异常，增强了程序的健壮性。
- **代码的可维护性**：模块化设计和良好的代码结构，使得问题定位和修复更加高效。

**改进建议：**

- **增加自动化测试**：引入单元测试框架，对关键模块进行自动化测试。
- **完善用户输入验证**：在用户输入阶段，增加更多验证，防止异常数据进入系统。
- **持续优化日志记录**：丰富日志信息，方便后续的维护和升级。

------

以上是本次程序测试日志与调试日志的详细记录，希望对项目的后续开发和维护有所帮助。